# "컷팅(Cutting)"이란 무엇인가?

## 컷팅의 의미

코드를 보면, **"컷팅"**은 이벤트에서 **안정 구간(stable region) 이후의 불안정한 부분을 제거**하는 것을 의미합니다.

## 상세 과정

### 1. 안정 구간 찾기

**충전 이벤트:**
- 이벤트 시작 후 3~10초 구간에서 안정 구간을 찾음
- 안정 구간: 전류/전력 변동이 적은 구간

**방전 이벤트:**
- 이벤트 끝까지의 마지막 안정 구간을 찾음
- 안정 구간: 전류/전력 변동이 적은 구간

### 2. 컷팅 수행

```matlab
% Cut event to stable region
t_seg_cut = t_seg(1:stable_end_idx);  % 안정 구간 끝까지만 사용
I_seg_cut = I_seg(1:stable_end_idx);
V_seg_cut = V_seg(1:stable_end_idx);
P_seg_cut = P_seg(1:stable_end_idx);
```

- **원본 이벤트**: 시작부터 끝까지 전체 데이터
- **컷팅 후 이벤트**: 시작부터 안정 구간 끝까지만 사용
- **제거된 부분**: 안정 구간 이후의 불안정한 부분

### 3. 컷팅 후 길이 확인

```matlab
driving_time_cut = t_seg_cut(end) - t_seg_cut(1);
if driving_time_cut < min_duration_after_cut  % 5초
    % 이벤트 제거
end
```

- 컷팅 후 남은 이벤트 길이를 확인
- 5초 미만이면 이벤트 제거

## 시각적 설명

```
[원본 이벤트 전체]
┌─────────────────────────────────────────────────┐
│ 시작 │ 안정 구간 │ 불안정 구간 │ 끝 │
└─────────────────────────────────────────────────┘
        └──────────┘
        이 부분만 사용 (컷팅)

[컷팅 후 이벤트]
┌─────────────────┐
│ 시작 │ 안정 구간 │
└─────────────────┘
```

## 왜 컷팅을 하는가?

1. **저항 계산 정확도 향상**
   - 안정 구간의 데이터만 사용하면 저항 계산이 더 정확함
   - 불안정한 구간은 노이즈가 많아 오차가 큼

2. **데이터 품질 향상**
   - 전이(transient) 구간의 불안정한 데이터 제거
   - 일관성 있는 데이터만 사용

## "이벤트 시작 부분을 자른다"는 표현에 대한 정정

현재 설명에는 **"이벤트 시작 부분을 자른다"**고 되어 있지만, 실제로는:
- ✅ **"안정 구간 이후의 부분을 자른다"** (끝 부분 제거)
- ❌ "이벤트 시작 부분을 자른다" (시작 부분 제거) - 잘못된 설명

**정확한 설명**: "이벤트에서 안정 구간만 남기고, 그 이후의 불안정한 부분을 제거한 후, 남은 이벤트 길이가 5초 미만이면 제거"

## 단계 7 필터링 조건 정확한 설명

**기존 설명**: "이벤트 시작 부분을 자른 후 길이가 5초 미만인 경우 제거"

**정확한 설명**: "안정 구간만 남기고 불안정한 부분을 제거(컷팅)한 후, 남은 이벤트 길이가 5초 미만인 경우 제거"

## 코드에서의 실제 동작

1. 안정 구간의 끝점(`stable_end_idx`)을 찾음
2. 안정 구간 끝까지만 데이터 사용 (`t_seg(1:stable_end_idx)`)
3. 컷팅 후 이벤트 길이 계산 (`driving_time_cut`)
4. 5초 미만이면 이벤트 제거
