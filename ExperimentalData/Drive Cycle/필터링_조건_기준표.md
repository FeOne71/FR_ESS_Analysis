# 필터링 조건 기준표

## 1. 충전 이벤트 필터링 조건

| 단계 | 필터링 조건 | 기준값 | 단위 | 설명 |
|------|------------|--------|------|------|
| 1 | 최소 지속시간 | < 10.0 | 초 (s) | 이벤트 지속시간이 10초 미만인 경우 제거 |
| 2 | 충전 방향 확인 | < 50% | 비율 (%) | 양의 전류 비율이 50% 미만인 경우 제거 (방전 이벤트로 판단) |
| 3 | 안정 구간 길이 확인 | < 10.0 | 초 (s) | 안정 구간(이벤트 시작 후 3~10초) 길이가 10초 미만인 경우 제거 |
| 4 | 전류 표준편차 | >= 2.00 | 암페어 (A) | 안정 구간 전류 표준편차가 2.00 A 이상인 경우 제거 |
| 5 | 변동계수 (CV) | >= 200.0 | 퍼센트 (%) | CV = std(I)/\|mean(I)\| >= 2.0 (200%)인 경우 제거 |
| 6 | 전력 표준편차 | >= 0.024 | 킬로와트 (kW) | 안정 구간 전력 표준편차가 0.024 kW 이상인 경우 제거 |
| 7 | 컷팅 후 최소 길이 | < 5.0 | 초 (s) | 이벤트 시작 부분을 자른 후 길이가 5초 미만인 경우 제거 |

---

## 2. 방전 이벤트 필터링 조건

| 단계 | 필터링 조건 | 기준값 | 단위 | 설명 |
|------|------------|--------|------|------|
| 1 | 최소 지속시간 | < 30.0 | 초 (s) | 이벤트 지속시간이 30초 미만인 경우 제거 |
| 2 | 방전 방향 확인 | 모두 음의 전류 아님 | - | 모든 전류가 음수가 아닌 경우 제거 (충전 이벤트로 판단) |
| 3 | 안정 구간 길이 확인 | < 3.0 | 초 (s) | 안정 구간(이벤트 끝까지) 길이가 3초 미만인 경우 제거 |
| 4 | 전류 표준편차 | >= 0.10 | 암페어 (A) | 안정 구간 전류 표준편차가 0.10 A 이상인 경우 제거 |
| 5 | 변동계수 (CV) | >= 10.0 | 퍼센트 (%) | CV = std(I)/\|mean(I)\| >= 0.1 (10%)인 경우 제거 |
| 6 | 전력 표준편차 | >= 0.024 | 킬로와트 (kW) | 안정 구간 전력 표준편차가 0.024 kW 이상인 경우 제거 |
| 7 | 컷팅 후 최소 길이 | < 5.0 | 초 (s) | 이벤트 시작 부분을 자른 후 길이가 5초 미만인 경우 제거 |

---

## 3. 충전 vs 방전 필터링 조건 비교

| 단계 | 필터링 조건 | 충전 기준값 | 방전 기준값 | 차이점 |
|------|------------|------------|------------|--------|
| 1 | 최소 지속시간 | < 10.0초 | < 30.0초 | 방전이 3배 더 엄격 (30초) |
| 2 | 방향 확인 | < 50% 양의 전류 | 모두 음의 전류 | 충전: 비율 기준, 방전: 절대 기준 |
| 3 | 안정 구간 길이 | < 10.0초 (3~10초 구간) | < 3.0초 (끝까지) | 충전: 더 긴 안정 구간 요구 |
| 4 | 전류 표준편차 | >= 2.00 A | >= 0.10 A | 충전이 20배 더 관대 (2.0A vs 0.1A) |
| 5 | 변동계수 (CV) | >= 200.0% (2.0) | >= 10.0% (0.1) | 충전이 20배 더 관대 (200% vs 10%) |
| 6 | 전력 표준편차 | >= 0.024 kW | >= 0.024 kW | 동일 |
| 7 | 컷팅 후 최소 길이 | < 5.0초 | < 5.0초 | 동일 |

---

## 4. 필터링 조건 상세 설명

### 단계 1: 최소 지속시간

**목적**: 너무 짧은 이벤트 제거

- **충전**: 10.0초 미만
- **방전**: 30.0초 미만
- **이유**: 충전은 상대적으로 빠르게 진행되므로 짧은 시간도 유효할 수 있으나, 방전은 더 긴 안정 구간이 필요

**적용**: 이벤트 시작(idle → driving 전환)부터 끝(driving → idle 전환)까지의 시간

---

### 단계 2: 방향 확인

**목적**: 충전/방전 이벤트 구분

- **충전**: 양의 전류 비율이 50% 미만이면 제거
- **방전**: 모든 전류가 음수가 아니면 제거
- **이유**: 잘못 분류된 이벤트 제거

**적용**: 안정 구간의 전류 데이터 분석

---

### 단계 3: 안정 구간 길이 확인

**목적**: 충분한 안정 구간 확보

- **충전**: 이벤트 시작 후 3~10초 구간이 10초 미만
- **방전**: 이벤트 끝까지의 안정 구간이 3초 미만
- **이유**: 저항 계산을 위한 안정적인 데이터 구간 필요

**적용**: 안정 구간 인식 알고리즘 사용

---

### 단계 4: 전류 표준편차

**목적**: 노이즈가 많은 불안정한 이벤트 제거

- **충전**: 표준편차 >= 2.00 A
- **방전**: 표준편차 >= 0.10 A
- **이유**: 안정 구간에서 전류 변동이 크면 저항 계산에 부적합
- **차이점**: 방전이 20배 더 엄격 (0.1A vs 2.0A)

**적용**: 안정 구간의 전류 표준편차 계산

---

### 단계 5: 변동계수 (Coefficient of Variation, CV)

**목적**: 평균 대비 상대적 변동성 평가

- **공식**: CV = std(I) / |mean(I)|
- **충전**: CV >= 2.0 (200%)
- **방전**: CV >= 0.1 (10%)
- **이유**: 평균값 대비 변동이 너무 크면 데이터 품질 저하
- **차이점**: 충전이 20배 더 관대 (200% vs 10%)

**적용**: 안정 구간의 전류 데이터로 계산

---

### 단계 6: 전력 표준편차

**목적**: 전력 변동이 큰 이벤트 제거

- **기준**: 표준편차 >= 0.024 kW (충전/방전 동일)
- **이유**: 전력 = 전압 × 전류이므로, 전력 변동이 크면 이벤트가 불안정

**적용**: 안정 구간의 전력 표준편차 계산

---

### 단계 7: 컷팅 후 최소 길이

**목적**: 전이 구간 제거 후 유효 데이터 확보

- **기준**: < 5.0초 (충전/방전 동일)
- **이유**: 이벤트 시작 부분의 전이 구간(transient)을 제거한 후에도 충분한 데이터가 남아있어야 함
- **컷팅**: 이벤트 시작 부분의 불안정한 구간 제거

**적용**: 전이 구간 제거 후 남은 이벤트 길이 확인

---

## 5. 필터링 조건 적용 순서

```
전체 전환 이벤트
    ↓
[단계 1] 최소 지속시간 필터
    ↓
[단계 2] 방향 확인 필터
    ↓
[단계 3] 안정 구간 길이 확인
    ↓
[단계 4-6] 동시 확인
    ├─ [단계 4] 전류 표준편차
    ├─ [단계 5] 변동계수
    └─ [단계 6] 전력 표준편차
    ↓
[단계 7] 컷팅 후 최소 길이 확인
    ↓
최종 검출된 이벤트
```

**참고**: 단계 4, 5, 6은 동시에 확인되며, 하나라도 기준을 초과하면 제거됩니다.

---

## 6. 필터링 조건 설정 근거

### 충전 vs 방전 기준값 차이

1. **최소 지속시간**: 방전(30초) > 충전(10초)
   - 방전은 더 긴 안정 구간 필요
   - 충전은 상대적으로 빠른 프로세스

2. **전류 표준편차**: 충전(2.0A) > 방전(0.1A)
   - 충전 전류가 일반적으로 더 크므로 변동 허용 범위가 넓음
   - 방전은 더 정밀한 측정 필요

3. **변동계수**: 충전(200%) > 방전(10%)
   - 충전: 평균 전류가 크므로 같은 절대 변동에도 CV가 작음
   - 방전: 평균 전류가 작으므로 상대적으로 엄격한 기준 필요

4. **공통 기준**: 전력 표준편차(0.024 kW), 컷팅 후 최소 길이(5초)
   - 충전/방전 모두 동일한 기준 적용

---

## 7. 코드에서의 변수명 (참고)

```matlab
% Charging Event Detection Parameters
min_duration_chg  = 10;            % 단계 1
max_I_std_chg     = 2;             % 단계 4
max_CV_chg        = 2;             % 단계 5 (2.0 = 200%)
max_P_std_chg     = Pnom * 0.1;    % 단계 6 (0.024 kW)

% Discharging Event Detection Parameters
min_duration_dchg = 30;            % 단계 1
max_I_std_dchg    = 0.1;           % 단계 4
max_CV_dchg       = 0.1;           % 단계 5 (0.1 = 10%)
max_P_std_dchg    = Pnom * 0.1;    % 단계 6 (0.024 kW)
```

**참고**: `Pnom * 0.1 = 0.024 kW` (정격 전력의 10%)
